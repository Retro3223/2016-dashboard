<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">

        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="css/c3.css">
        <link rel="stylesheet" type="text/css" href="css/dacss.css">
</head>
<body>

<script src="/js/d3.js" type="text/javascript"></script>
<script src="/js/c3.js" type="text/javascript"></script>
<script src="/js/networktables.js" type="text/javascript"></script>
<!--
<script src="/js/utils.js" type="text/javascript"></script>
-->

<script src="/js/jquery-2.1.3.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.js" type="text/javascript"></script>
<script src="/js/stuff.js" type="text/javascript"></script>
<script src="/js/cameras.js" type="text/javascript"></script>

<div id='Main' style="margin: 10px">
    <ul id='tabs' class="nav nav-tabs" role="tablist">
        <li role="presentation"  class="active">
            <a href="#teleop">Teleop</a>
        </li>
        <li role="presentation">
            <a href="#auto">Auto</a>
        </li>
        <li role="presentation">
            <a href="#other">Scratch space</a>
        </li>
    </ul>
    <div id="Content" class="tab-content">
        <div role="tabpanel" class="tab-pane active" id="teleop">
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <div class="row">       
                            <div id="webcam0_stream" class="camera">
                                <img src="/img/indianfront.png"/>
                            </div>
                        </div>
                        <div class="row">
                        Camera:
                            <button class="btn btn-warning">
                                Front
                            </button>
                            Drive
                            <button class="btn btn-success">
                                ??
                            </button>        
                        </div>
                            
                    </div>                   
                    <div class="col-md-5">
                        <div id="webcam1_stream" class="camera">
                            <img src="/img/indianback.png"/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary btn-lg btn-size">
                            Spit
                        </button>
                        <button class="btn btn-primary btn-lg btn-size">
                            Suck
                        </button>
                     </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <button class="btn btn-danger btn-lg btn-size">
                            Low Bar
                        </button>
                        <button class="btn btn-danger btn-lg btn-size">
                            Rock Wall
                        </button>
                    </div>
                    <div class="col-md-3">
                    		<button class="btn btn-danger btn-lg btn-size">
                            Rough Terrain
                        </button>
                        <button class="btn btn-danger btn-lg btn-size">
                            Chili Fries
                        </button>
                    </div>
                    <div class="col-md-3">
                    		<button class="btn btn-danger btn-lg btn-size">
                            Moat
                        </button>
                        <button class="btn btn-danger btn-lg btn-size">
                            Portcullis
                        </button>
                    </div>
                    <div class="col-md-3">
                    		<button class="btn btn-danger btn-lg btn-size">
                    			 Rampart
                    		</button>
                    </div>
                </div>            
             </div>   
        </div>
        <div role="tabpanel" class="tab-pane" id="auto">
            <label class="auto-option">
            	<label>
            	 <input type="radio" name="autochoice" value="lowbar"/>
            	Low Bar
            	</label>
            	<div class="pull-right">
            		<img src="/img/lowbar.jpg"/>
            	</div>
            </label>
            <label class="auto-option">
            	<label>
            	 <input type="radio" name="autochoice" value="roughterrain"/>
            	Rough Terrain
            	</label>
            	<div class="pull-right">
            		<img src="/img/roughterrain.jpg"/>
            	</div>
            </label>
            <label class="auto-option">
            	<label>
            	 <input type="radio" name="autochoice" value="moat"/>
            	Moat
            	</label>
            	<div class="pull-right">
            		<img src="/img/moat.jpg"/>
            	</div>
            </label>
            <label class="auto-option">
            	<label>
            	 <input type="radio" name="autochoice" value="rampart"/>
            	Rampart
            	</label>
            	<div class="pull-right">
            		<img src="/img/rampart.jpg"/>
            	</div>
            </label>
            <label class="auto-option">
            	<label>
            	 <input type="radio" name="autochoice" value="rockwall"/>
            	Rock Wall
            	</label>
            	<div class="pull-right">
            		<img src="/img/rockwall.jpg"/>
            	</div>
            </label>
        </div>
        <div role="tabpanel" class="tab-pane" id="other">
            <div>
                NetworkTables websocket: <span id="connectstate">Unknown state</span><br/>
                Robot: <span id="robotstate">Unknown state</span>
            </div>
            <hr/>


            <div id="chart">
            </div>
            
            <table id="nt" class="table table-striped">
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">
"use strict";
var chart;
var data = ['y'];
var dataChanged = false;
var maxSize = 100;
var frontCamera = {
	stream: "http://roborio-3223-frc:5800/?action=stream",
	test: "http://roborio-3223-frc:5800/?action=static",
	noSignal: "/img/indianfront.png",
	selector: "#webcam0_stream img"
};

var altCamera = {
	stream: "http://roborio-3223-frc:5801/?action=stream",
	test: "http://roborio-3223-frc:5801/?action=static",
	noSignal: "/img/indianback.png",
	selector: "#webcam1_stream img"
};

$(document).ready(function() {
	$(".auto-option input").change(function() {
	    $(".auto-option")
                .removeClass("selected-option");
	    $(this)
                .parents()
                .filter(".auto-option")
                .addClass("selected-option");
	});

        setupNetworkTables();
});

function setupNetworkTables() {
    NetworkTables.addWsConnectionListener(onNetworkTablesConnection, true);
    NetworkTables.addRobotConnectionListener(onRobotConnection, true);
    NetworkTables.addGlobalListener(onValueChanged, true);
}

function setupChart() {
    chart = c3.generate({data:{columns:[data]}});
    setInterval(chartRefresh, 200);
}


function onRobotConnection(connected) {
	$('#robotstate').text(connected ? "Connected!" : "Disconnected");
}

function onNetworkTablesConnection(connected) {
	var cameras = [frontCamera, altCamera];
	cameras.forEach(function(camera) {
		var img = $(camera.selector);
		if(connected) {
			img.attr('src', camera.stream);
		}else {
			img.attr('src', camera.noSignal);
		}
	});
	
	if (connected) {
		$("#connectstate").text("Connected!");
		
		// clear the table
		$("#nt tbody > tr").remove();
		
		
		
	} else {
		$("#connectstate").text("Disconnected!");
	}
}

function chartRefresh() {
    if(dataChanged) {
        chart.load ({
            columns:[data]
        });
        dataChanged = false;
    }
}

function onValueChanged(key, value, isNew) {

	// key thing here: we're using the various NetworkTable keys as
	// the id of the elements that we're appending, for simplicity. However,
	// the key names aren't always valid HTML identifiers, so we use
	// the NetworkTables.keyToId() function to convert them appropriately

	if (isNew) {
		var tr = $('<tr></tr>').appendTo($('#nt > tbody:last'));
		$('<td></td>').text(key).appendTo(tr);
		$('<td></td>').attr('id', NetworkTables.keyToId(key))
					   .text(value)
					   .appendTo(tr);

		
	} else {
	
		// similarly, use keySelector to convert the key to a valid jQuery
		// selector. This should work for class names also, not just for ids
		$('#' + NetworkTables.keySelector(key)).text(value);

            if (key=== "/SmartDashboard/theta"){
                dataChanged = true;
                var c = data.shift();
                data.unshift(value);
                data.unshift(c);
                if (data.length >= maxSize){			
                        data.pop();
                }
            }
	}
}

</script>

</body>
</html>
